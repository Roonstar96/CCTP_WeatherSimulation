//AUTHOR: Tane Cotterell-East (Roonstar96)

//SUMMARY: This script is responsible for the wind within a local climate. The wind speeds Min/Max
//variables are handles by the ClimateManagerClass, and the wind speed itself is handled in the update.
//The current speed is dictaded by the time of day and the current tempurate, as in real life wind is 
//generated by air movinf from an area of high pressure to somwhere with low, which is caused by
//fluxuating temperatures

using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class WindManager : MonoBehaviour
{
    [Header("Wind Variables")]
    [SerializeField] private float _windSpeed;
    [SerializeField] private float _speedMin;
    [SerializeField] private float _speedMax;
    [SerializeField] private float _climateAdjustment;

    [Header("Local Weather References and variables")]
    [SerializeField] private float _currentTemp;
    [SerializeField] private float _newTemp;
    [SerializeField] private LocalWeatherManager _weather;

    [Header("Climate Manager Reference")]
    [SerializeField] private ClimateManagerClass _climate;

    public float Speed { get => _windSpeed; set => _windSpeed = value; }
    public float WindMin { get => _speedMin; set => _speedMin = value; }
    public float WindMax { get => _speedMax; set => _speedMax = value; }
    public float WindAdjustment { get => _climateAdjustment; set => _climateAdjustment = value; }

    private void Awake()
    {
        if (_climate.Winter)
        {
            _windSpeed = Random.Range(_speedMax / 2, _speedMax) * _climateAdjustment;
            _windSpeed = _windSpeed / Mathf.Abs(_weather.Tempurature);
        }
        if (_climate.Summer)
        {
            _windSpeed = Random.Range(_speedMin, _speedMax / 2) * _climateAdjustment;
            _windSpeed = _windSpeed / Mathf.Abs(_weather.Tempurature);
        }
        else
        {
            _windSpeed = Random.Range(_speedMin, _speedMax - (_speedMax / 4)) * _climateAdjustment;
            _windSpeed = _windSpeed / Mathf.Abs(_weather.Tempurature);
        }

        if (_windSpeed < _speedMin)
        {
            _windSpeed = _speedMin;
        }
        if (_windSpeed > _speedMax)
        {
            _windSpeed = _speedMax;
        }

        _currentTemp = _weather.Tempurature;
    }
    
    public void CheckTemperature()
    {
        _newTemp = _weather.Tempurature;

        if (_currentTemp < _newTemp)
        {
            DecreaseWindSpeed();
        }    
        else if (_currentTemp > _newTemp)
        {
            IncreaseWindSpeed();
        }
        else
        {
            return;
        }
    }

    private void IncreaseWindSpeed()
    {
        if (_climate.Winter)
        {
            _windSpeed = (_windSpeed + Random.Range(0, _windSpeed / _climateAdjustment) + 1);
        }
        if (_climate.Summer)
        {
            _windSpeed = (_windSpeed + Random.Range(0, _windSpeed / _climateAdjustment) - 1);
        }
        else
        {
            _windSpeed = _windSpeed + Random.Range(0, _windSpeed / _climateAdjustment);
        }

        if (_windSpeed > _speedMax)
        {
            _windSpeed = _speedMax;
        }

        _currentTemp = _weather.Tempurature;
    }

    private void DecreaseWindSpeed()
    {
        if (_climate.Winter)
        {
            _windSpeed = (_windSpeed - Random.Range(0, _windSpeed / _climateAdjustment) - 1);
        }
        if (_climate.Summer)
        {
            _windSpeed = (_windSpeed - Random.Range(0, _windSpeed / _climateAdjustment) + 1);
        }
        else
        {
            _windSpeed = _windSpeed - Random.Range(0, _windSpeed / _climateAdjustment);
        }

        if (_windSpeed < _speedMin)
        {
            _windSpeed = _speedMax;
        }

        _currentTemp = _weather.Tempurature;
    }

}
